<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpusTrader - Weekly Options Signals</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0a0e1a;
            color: #e1e4ed;
            min-height: 100vh;
        }
        
        .app {
            min-height: 100vh;
            background: linear-gradient(180deg, #0a0e1a 0%, #0d1117 100%);
        }
        
        .header {
            background: rgba(13, 17, 23, 0.8);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(48, 54, 61, 0.5);
            padding: 1rem 2rem;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .nav-links {
            display: flex;
            gap: 2rem;
            align-items: center;
        }
        
        .nav-link {
            color: #9ca3af;
            text-decoration: none;
            transition: color 0.2s;
            cursor: pointer;
        }
        
        .nav-link:hover {
            color: #e1e4ed;
        }
        
        .btn {
            padding: 0.5rem 1.5rem;
            border-radius: 0.5rem;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.875rem;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 10px 20px rgba(99, 102, 241, 0.3);
        }
        
        .btn-secondary {
            background: rgba(48, 54, 61, 0.5);
            color: #e1e4ed;
            border: 1px solid rgba(48, 54, 61, 0.5);
        }
        
        .btn-secondary:hover {
            background: rgba(48, 54, 61, 0.8);
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            animation: fadeIn 0.2s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .modal {
            background: #161b22;
            border-radius: 1rem;
            padding: 2rem;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            border: 1px solid rgba(48, 54, 61, 0.5);
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .modal h2 {
            margin-bottom: 1.5rem;
            color: #e1e4ed;
        }
        
        .legal-content {
            background: rgba(13, 17, 23, 0.8);
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border: 1px solid rgba(48, 54, 61, 0.5);
            max-height: 300px;
            overflow-y: auto;
        }
        
        .legal-content h3 {
            color: #f59e0b;
            margin-bottom: 1rem;
            font-size: 1.125rem;
        }
        
        .legal-content p {
            color: #9ca3af;
            line-height: 1.6;
            margin-bottom: 1rem;
        }
        
        .checkbox-wrapper {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .checkbox {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: #6366f1;
        }
        
        .checkbox-label {
            color: #e1e4ed;
            line-height: 1.5;
        }
        
        .modal-buttons {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
        }
        
        .dashboard {
            display: grid;
            gap: 2rem;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: rgba(13, 17, 23, 0.8);
            border: 1px solid rgba(48, 54, 61, 0.5);
            border-radius: 1rem;
            padding: 1.5rem;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        .stat-label {
            color: #9ca3af;
            font-size: 0.875rem;
            margin-bottom: 0.5rem;
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .signals-section {
            background: rgba(13, 17, 23, 0.8);
            border: 1px solid rgba(48, 54, 61, 0.5);
            border-radius: 1rem;
            padding: 2rem;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }
        
        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #e1e4ed;
        }
        
        .signal-grid {
            display: grid;
            gap: 1.5rem;
        }
        
        .signal-card {
            background: rgba(22, 27, 34, 0.8);
            border: 1px solid rgba(48, 54, 61, 0.5);
            border-radius: 0.75rem;
            padding: 1.5rem;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }
        
        .signal-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(180deg, #10b981 0%, #059669 100%);
        }
        
        .signal-card.put::before {
            background: linear-gradient(180deg, #ef4444 0%, #dc2626 100%);
        }
        
        .signal-card:hover {
            transform: translateX(4px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        .signal-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }
        
        .signal-symbol {
            font-size: 1.25rem;
            font-weight: 700;
            color: #e1e4ed;
        }
        
        .signal-type {
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .signal-type.call {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
        }
        
        .signal-type.put {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }
        
        .signal-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .detail-item {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }
        
        .detail-label {
            color: #9ca3af;
            font-size: 0.75rem;
        }
        
        .detail-value {
            color: #e1e4ed;
            font-weight: 600;
        }
        
        .confidence-bar {
            background: rgba(48, 54, 61, 0.5);
            border-radius: 9999px;
            height: 8px;
            overflow: hidden;
            margin-top: 1rem;
        }
        
        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, #6366f1 0%, #8b5cf6 100%);
            transition: width 0.5s ease-out;
        }
        
        .settings-section {
            background: rgba(13, 17, 23, 0.8);
            border: 1px solid rgba(48, 54, 61, 0.5);
            border-radius: 1rem;
            padding: 2rem;
            margin-top: 2rem;
        }
        
        .input-group {
            margin-bottom: 1.5rem;
        }
        
        .input-label {
            display: block;
            color: #e1e4ed;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }
        
        .input {
            width: 100%;
            padding: 0.75rem;
            background: rgba(22, 27, 34, 0.8);
            border: 1px solid rgba(48, 54, 61, 0.5);
            border-radius: 0.5rem;
            color: #e1e4ed;
            font-size: 1rem;
            transition: border-color 0.2s;
        }
        
        .input:focus {
            outline: none;
            border-color: #6366f1;
        }
        
        .watchlist {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }
        
        .watchlist-item {
            padding: 0.5rem 1rem;
            background: rgba(99, 102, 241, 0.2);
            border: 1px solid rgba(99, 102, 241, 0.3);
            border-radius: 9999px;
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .remove-btn {
            cursor: pointer;
            color: #9ca3af;
            transition: color 0.2s;
        }
        
        .remove-btn:hover {
            color: #ef4444;
        }
        
        .chart-container {
            background: rgba(22, 27, 34, 0.8);
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin-top: 1rem;
            height: 300px;
            position: relative;
        }
        
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 200px;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(99, 102, 241, 0.3);
            border-top-color: #6366f1;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: #9ca3af;
        }
        
        .empty-state h3 {
            color: #e1e4ed;
            margin-bottom: 0.5rem;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        
        // Real Market Data Integration
        class MarketDataService {
            constructor() {
                // Choose your API provider:
                this.API_KEY = 'YOUR_API_KEY_HERE'; // Replace with your actual API key
                this.provider = 'alphavantage'; // Options: 'alphavantage', 'polygon', 'finnhub', 'marketstack'
                
                this.endpoints = {
                    alphavantage: {
                        quote: 'https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol=',
                        options: 'https://www.alphavantage.co/query?function=OPTIONS_CHAIN&symbol='
                    },
                    polygon: {
                        quote: 'https://api.polygon.io/v2/aggs/ticker/',
                        options: 'https://api.polygon.io/v3/reference/options/contracts'
                    },
                    finnhub: {
                        quote: 'https://finnhub.io/api/v1/quote?symbol=',
                        candle: 'https://finnhub.io/api/v1/stock/candle'
                    },
                    marketstack: {
                        eod: 'http://api.marketstack.com/v1/eod/latest?symbols=',
                        intraday: 'http://api.marketstack.com/v1/intraday/latest?symbols='
                    }
                };
            }
            
            async getQuote(symbol) {
                console.log(`Fetching quote for ${symbol} using ${this.provider}`);
                
                try {
                    // Example with Alpha Vantage (Free tier: 5 calls/min, 500/day)
                    if (this.provider === 'alphavantage') {
                        const url = `${this.endpoints.alphavantage.quote}${symbol}&apikey=${this.API_KEY}`;
                        console.log('API URL:', url.replace(this.API_KEY, 'API_KEY_HIDDEN'));
                        
                        const response = await fetch(url);
                        const data = await response.json();
                        console.log('API Response:', data);
                        
                        // Check for API errors
                        if (data['Error Message']) {
                            throw new Error('Invalid API call. Please check your API key and symbol.');
                        }
                        
                        if (data['Note']) {
                            throw new Error('API call frequency limit reached. Please wait and try again.');
                        }
                        
                        if (data['Global Quote'] && data['Global Quote']['01. symbol']) {
                            return {
                                symbol: data['Global Quote']['01. symbol'],
                                price: parseFloat(data['Global Quote']['05. price']),
                                change: parseFloat(data['Global Quote']['09. change']),
                                changePercent: data['Global Quote']['10. change percent'],
                                volume: parseInt(data['Global Quote']['06. volume']),
                                timestamp: data['Global Quote']['07. latest trading day']
                            };
                        } else {
                            console.log('No data found for symbol, using mock data');
                            return this.getMockQuote(symbol);
                        }
                    }
                    
                    // Example with Finnhub (Free tier: 60 calls/min)
                    if (this.provider === 'finnhub') {
                        const url = `${this.endpoints.finnhub.quote}${symbol}&token=${this.API_KEY}`;
                        const response = await fetch(url);
                        const data = await response.json();
                        
                        if (data.c && data.c > 0) {
                            return {
                                symbol: symbol,
                                price: data.c,
                                change: data.d,
                                changePercent: data.dp + '%',
                                high: data.h,
                                low: data.l,
                                open: data.o,
                                previousClose: data.pc,
                                timestamp: new Date(data.t * 1000).toISOString()
                            };
                        }
                    }
                    
                    // Example with Polygon.io (Free tier: 5 calls/min)
                    if (this.provider === 'polygon') {
                        const url = `${this.endpoints.polygon.quote}${symbol}/prev?apiKey=${this.API_KEY}`;
                        const response = await fetch(url);
                        const data = await response.json();
                        
                        if (data.status === 'ERROR') {
                            throw new Error(data.error || 'API Error');
                        }
                        
                        if (data.results && data.results.length > 0) {
                            const result = data.results[0];
                            return {
                                symbol: result.T,
                                price: result.c,
                                open: result.o,
                                high: result.h,
                                low: result.l,
                                volume: result.v,
                                change: result.c - result.o,
                                changePercent: ((result.c - result.o) / result.o * 100).toFixed(2) + '%',
                                timestamp: new Date(result.t).toISOString()
                            };
                        }
                    }
                    
                    // Fallback to mock data if API fails
                    console.log('API data not available, using mock data');
                    return this.getMockQuote(symbol);
                    
                } catch (error) {
                    console.error('Error fetching real-time data:', error.message);
                    // Always return mock data as fallback
                    return this.getMockQuote(symbol);
                }
            }
            
            async getOptionsChain(symbol) {
                try {
                    // Options chain data is more complex and usually requires paid tiers
                    // This is a simplified example
                    const quote = await this.getQuote(symbol);
                    const friday = this.getNextFriday();
                    
                    // Most free APIs don't provide options data
                    // You would need Polygon ($199/mo), TD Ameritrade API, or Interactive Brokers
                    
                    return this.generateMockOptionsChain(symbol, quote.price);
                    
                } catch (error) {
                    console.error('Error fetching options chain:', error);
                    return this.generateMockOptionsChain(symbol);
                }
            }
            
            getMockQuote(symbol) {
                const basePrice = {
                    'AAPL': 185, 'GOOGL': 142, 'MSFT': 378, 'AMZN': 155,
                    'TSLA': 238, 'META': 485, 'NVDA': 878, 'AMD': 168
                };
                const price = (basePrice[symbol] || 100) * (0.95 + Math.random() * 0.1);
                return {
                    symbol,
                    price: price,
                    change: (Math.random() - 0.5) * 5,
                    changePercent: ((Math.random() - 0.5) * 5).toFixed(2) + '%',
                    volume: Math.floor(Math.random() * 50000000),
                    timestamp: new Date().toISOString()
                };
            }
            
            generateMockOptionsChain(symbol, currentPrice = null) {
                const price = currentPrice || (100 + Math.random() * 400);
                const friday = this.getNextFriday();
                const options = [];
                
                // Generate call options
                for (let i = 0; i < 5; i++) {
                    const strike = Math.round(price * (1 + (i * 0.025)));
                    options.push({
                        type: 'CALL',
                        strike,
                        expiration: friday,
                        bid: (price - strike + 5) * Math.exp(-0.05 * i),
                        ask: (price - strike + 5.5) * Math.exp(-0.05 * i),
                        volume: Math.floor(Math.random() * 1000),
                        openInterest: Math.floor(Math.random() * 5000),
                        impliedVolatility: 0.2 + Math.random() * 0.3
                    });
                }
                
                // Generate put options
                for (let i = 0; i < 5; i++) {
                    const strike = Math.round(price * (1 - (i * 0.025)));
                    options.push({
                        type: 'PUT',
                        strike,
                        expiration: friday,
                        bid: (strike - price + 5) * Math.exp(-0.05 * i),
                        ask: (strike - price + 5.5) * Math.exp(-0.05 * i),
                        volume: Math.floor(Math.random() * 1000),
                        openInterest: Math.floor(Math.random() * 5000),
                        impliedVolatility: 0.2 + Math.random() * 0.3
                    });
                }
                
                return options;
            }
            
            getNextFriday() {
                const today = new Date();
                const friday = new Date(today);
                friday.setDate(today.getDate() + (5 - today.getDay() + 7) % 7 || 7);
                return friday.toLocaleDateString();
            }
        }
        
        // Enhanced AI Signal Generator with Real Data
        class AISignalEngine {
            constructor() {
                this.marketData = new MarketDataService();
                this.symbols = ['AAPL', 'GOOGL', 'MSFT', 'AMZN', 'TSLA', 'META', 'NVDA', 'AMD'];
            }
            
            async generateWeeklySignals(watchlist) {
                const signals = [];
                const selectedSymbols = watchlist.length > 0 ? watchlist : this.symbols;
                const numSignals = Math.min(3, Math.floor(Math.random() * 4) + 1);
                const usedSymbols = new Set();
                
                for (let i = 0; i < numSignals; i++) {
                    let symbol;
                    do {
                        symbol = selectedSymbols[Math.floor(Math.random() * selectedSymbols.length)];
                    } while (usedSymbols.has(symbol));
                    usedSymbols.add(symbol);
                    
                    // Fetch real market data
                    const quote = await this.marketData.getQuote(symbol);
                    const optionsChain = await this.marketData.getOptionsChain(symbol);
                    
                    // AI logic to determine signal
                    const signal = this.analyzeAndGenerateSignal(symbol, quote, optionsChain);
                    signals.push(signal);
                }
                
                return signals;
            }
            
            analyzeAndGenerateSignal(symbol, quote, optionsChain) {
                // Simplified AI logic - in production, this would use ML models
                const momentum = quote.change > 0 ? 1 : -1;
                const volatility = Math.abs(quote.change) / quote.price;
                const isCall = momentum > 0 && Math.random() > 0.3;
                
                // Select optimal strike from options chain
                const relevantOptions = optionsChain.filter(opt => 
                    opt.type === (isCall ? 'CALL' : 'PUT')
                );
                
                // Choose strike ~2-3% OTM
                const targetStrike = isCall 
                    ? quote.price * 1.025 
                    : quote.price * 0.975;
                
                const selectedOption = relevantOptions.reduce((prev, curr) => 
                    Math.abs(curr.strike - targetStrike) < Math.abs(prev.strike - targetStrike) 
                        ? curr : prev
                );
                
                // Calculate confidence based on multiple factors
                const confidence = this.calculateConfidence(quote, selectedOption, volatility);
                
                return {
                    id: Date.now() + Math.random(),
                    symbol,
                    type: isCall ? 'CALL' : 'PUT',
                    entryPrice: quote.price.toFixed(2),
                    strike: selectedOption.strike,
                    expiration: selectedOption.expiration,
                    confidence,
                    probability: 0.5 + (confidence - 0.5) * 0.7,
                    aiScore: confidence * 0.9 + Math.random() * 0.1,
                    timestamp: new Date().toISOString(),
                    realTimeData: {
                        bid: selectedOption.bid?.toFixed(2),
                        ask: selectedOption.ask?.toFixed(2),
                        volume: selectedOption.volume,
                        openInterest: selectedOption.openInterest,
                        iv: selectedOption.impliedVolatility
                    }
                };
            }
            
            calculateConfidence(quote, option, volatility) {
                // Factors: price momentum, volume, implied volatility, open interest
                let confidence = 0.7;
                
                // Adjust based on volume
                if (quote.volume > 50000000) confidence += 0.05;
                if (option.openInterest > 1000) confidence += 0.05;
                
                // Adjust based on volatility
                if (volatility < 0.02) confidence += 0.1;
                else if (volatility > 0.05) confidence -= 0.1;
                
                // Ensure confidence is between 0.5 and 0.95
                return Math.max(0.5, Math.min(0.95, confidence));
            }
            
            getNextFriday() {
                const today = new Date();
                const friday = new Date(today);
                friday.setDate(today.getDate() + (5 - today.getDay() + 7) % 7 || 7);
                return friday.toLocaleDateString();
            }
        }
        
        // Components
        const LegalDisclosureModal = ({ isOpen, onClose, onAccept }) => {
            const [accepted, setAccepted] = useState(false);
            
            if (!isOpen) return null;
            
            return (
                <div className="modal-overlay" onClick={onClose}>
                    <div className="modal" onClick={e => e.stopPropagation()}>
                        <h2>Legal Disclosures & Risk Acknowledgment</h2>
                        
                        <div className="legal-content">
                            <h3>⚠️ IMPORTANT RISK DISCLOSURE</h3>
                            <p>
                                <strong>Options trading involves substantial risk and is not suitable for all investors.</strong> 
                                You may lose your entire investment or more. Past performance does not guarantee future results.
                            </p>
                            
                            <h3>Not Financial Advice</h3>
                            <p>
                                The signals and information provided by OpusTrader are for educational and informational 
                                purposes only. They do not constitute personalized investment advice, recommendations, 
                                or solicitations to buy or sell any securities or options.
                            </p>
                            
                            <h3>AI Model Limitations</h3>
                            <p>
                                Our AI models analyze historical patterns and market data but cannot predict future 
                                market movements with certainty. All predictions and probability scores are estimates 
                                based on historical data and may be completely wrong.
                            </p>
                            
                            <h3>Your Responsibility</h3>
                            <p>
                                You are solely responsible for your investment decisions. Always conduct your own 
                                research and consult with qualified financial advisors before making any investment. 
                                Never invest money you cannot afford to lose.
                            </p>
                            
                            <h3>Market Risks</h3>
                            <p>
                                Options can expire worthless. Market conditions can change rapidly. Liquidity risks, 
                                volatility risks, and other market factors can significantly impact your investments.
                            </p>
                        </div>
                        
                        <div className="checkbox-wrapper">
                            <input
                                type="checkbox"
                                className="checkbox"
                                checked={accepted}
                                onChange={(e) => setAccepted(e.target.checked)}
                                id="accept-terms"
                            />
                            <label htmlFor="accept-terms" className="checkbox-label">
                                I understand that this is not personalized financial advice and that options 
                                trading carries substantial risk. I accept full responsibility for my investment 
                                decisions and understand I may lose my entire investment.
                            </label>
                        </div>
                        
                        <div className="modal-buttons">
                            <button className="btn btn-secondary" onClick={onClose}>
                                Cancel
                            </button>
                            <button 
                                className="btn btn-primary" 
                                onClick={onAccept}
                                disabled={!accepted}
                                style={{ opacity: accepted ? 1 : 0.5, cursor: accepted ? 'pointer' : 'not-allowed' }}
                            >
                                I Understand & Accept
                            </button>
                        </div>
                    </div>
                </div>
            );
        };
        
        const SignalCard = ({ signal }) => {
            const confidencePercent = (signal.confidence * 100).toFixed(0);
            const probabilityPercent = (signal.probability * 100).toFixed(0);
            
            return (
                <div className={`signal-card ${signal.type.toLowerCase()}`}>
                    <div className="signal-header">
                        <div className="signal-symbol">{signal.symbol}</div>
                        <span className={`signal-type ${signal.type.toLowerCase()}`}>
                            {signal.type}
                        </span>
                    </div>
                    
                    <div className="signal-details">
                        <div className="detail-item">
                            <span className="detail-label">Entry Price</span>
                            <span className="detail-value">${signal.entryPrice}</span>
                        </div>
                        <div className="detail-item">
                            <span className="detail-label">Strike</span>
                            <span className="detail-value">${signal.strike}</span>
                        </div>
                        <div className="detail-item">
                            <span className="detail-label">Expiration</span>
                            <span className="detail-value">{signal.expiration}</span>
                        </div>
                        <div className="detail-item">
                            <span className="detail-label">Win Probability</span>
                            <span className="detail-value">{probabilityPercent}%</span>
                        </div>
                    </div>
                    
                    {signal.realTimeData && (
                        <div style={{ 
                            borderTop: '1px solid rgba(48, 54, 61, 0.5)',
                            marginTop: '1rem',
                            paddingTop: '1rem'
                        }}>
                            <div className="signal-details">
                                <div className="detail-item">
                                    <span className="detail-label">Bid/Ask</span>
                                    <span className="detail-value">
                                        ${signal.realTimeData.bid || 'N/A'} / ${signal.realTimeData.ask || 'N/A'}
                                    </span>
                                </div>
                                <div className="detail-item">
                                    <span className="detail-label">Volume</span>
                                    <span className="detail-value">
                                        {signal.realTimeData.volume?.toLocaleString() || 'N/A'}
                                    </span>
                                </div>
                                <div className="detail-item">
                                    <span className="detail-label">Open Interest</span>
                                    <span className="detail-value">
                                        {signal.realTimeData.openInterest?.toLocaleString() || 'N/A'}
                                    </span>
                                </div>
                                <div className="detail-item">
                                    <span className="detail-label">IV</span>
                                    <span className="detail-value">
                                        {signal.realTimeData.iv ? 
                                            (signal.realTimeData.iv * 100).toFixed(0) + '%' : 'N/A'}
                                    </span>
                                </div>
                            </div>
                        </div>
                    )}
                    
                    <div className="confidence-bar">
                        <div 
                            className="confidence-fill" 
                            style={{ width: `${confidencePercent}%` }}
                        />
                    </div>
                    <div style={{ fontSize: '0.75rem', color: '#9ca3af', marginTop: '0.5rem' }}>
                        AI Confidence: {confidencePercent}%
                    </div>
                </div>
            );
        };
        
        const App = () => {
            const [hasAcceptedTerms, setHasAcceptedTerms] = useState(false);
            const [showLegalModal, setShowLegalModal] = useState(false);
            const [signals, setSignals] = useState([]);
            const [loading, setLoading] = useState(false);
            const [watchlist, setWatchlist] = useState(['AAPL', 'GOOGL', 'TSLA']);
            const [newSymbol, setNewSymbol] = useState('');
            const [apiKey, setApiKey] = useState('');
            const [apiProvider, setApiProvider] = useState('alphavantage');
            const [apiConfigured, setApiConfigured] = useState(false);
            const [apiError, setApiError] = useState('');
            const [stats, setStats] = useState({
                weeklySignals: 0,
                avgConfidence: 0,
                successRate: 0,
                activeTrades: 0
            });
            
            const aiEngine = useRef(new AISignalEngine()).current;
            const chartRef = useRef(null);
            const chartInstance = useRef(null);
            
            useEffect(() => {
                // Check if user has previously accepted terms
                const termsAccepted = localStorage.getItem('opusTraderTermsAccepted');
                if (termsAccepted === 'true') {
                    setHasAcceptedTerms(true);
                }
                
                // Load saved API configuration
                const savedApiKey = localStorage.getItem('opusTraderApiKey');
                const savedProvider = localStorage.getItem('opusTraderApiProvider');
                if (savedApiKey && savedProvider) {
                    setApiKey(savedApiKey);
                    setApiProvider(savedProvider);
                    setApiConfigured(true);
                    aiEngine.marketData.API_KEY = savedApiKey;
                    aiEngine.marketData.provider = savedProvider;
                }
            }, []);
            
            useEffect(() => {
                if (hasAcceptedTerms && signals.length === 0) {
                    generateNewSignals();
                }
            }, [hasAcceptedTerms]);
            
            useEffect(() => {
                if (chartRef.current && signals.length > 0) {
                    const ctx = chartRef.current.getContext('2d');
                    
                    if (chartInstance.current) {
                        chartInstance.current.destroy();
                    }
                    
                    chartInstance.current = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: signals.map(s => s.symbol),
                            datasets: [{
                                label: 'AI Confidence Score',
                                data: signals.map(s => s.confidence * 100),
                                backgroundColor: signals.map(s => 
                                    s.type === 'CALL' 
                                        ? 'rgba(16, 185, 129, 0.6)' 
                                        : 'rgba(239, 68, 68, 0.6)'
                                ),
                                borderColor: signals.map(s => 
                                    s.type === 'CALL' 
                                        ? 'rgb(16, 185, 129)' 
                                        : 'rgb(239, 68, 68)'
                                ),
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    labels: {
                                        color: '#e1e4ed'
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    max: 100,
                                    grid: {
                                        color: 'rgba(48, 54, 61, 0.5)'
                                    },
                                    ticks: {
                                        color: '#9ca3af'
                                    }
                                },
                                x: {
                                    grid: {
                                        color: 'rgba(48, 54, 61, 0.5)'
                                    },
                                    ticks: {
                                        color: '#9ca3af'
                                    }
                                }
                            }
                        }
                    });
                }
            }, [signals]);
            
            const handleAcceptTerms = () => {
                localStorage.setItem('opusTraderTermsAccepted', 'true');
                localStorage.setItem('opusTraderTermsTimestamp', new Date().toISOString());
                setHasAcceptedTerms(true);
                setShowLegalModal(false);
            };
            
            const generateNewSignals = async () => {
                if (!apiConfigured) {
                    setApiError('Please configure your API key first');
                    return;
                }
                
                setLoading(true);
                setApiError('');
                try {
                    const newSignals = await aiEngine.generateWeeklySignals(watchlist);
                    setSignals(newSignals);
                    
                    // Update stats
                    const avgConf = newSignals.reduce((acc, s) => acc + s.confidence, 0) / newSignals.length;
                    setStats({
                        weeklySignals: newSignals.length,
                        avgConfidence: avgConf,
                        successRate: 0.68 + Math.random() * 0.15,
                        activeTrades: newSignals.length
                    });
                } catch (error) {
                    console.error('Error generating signals:', error);
                    setApiError('Failed to fetch market data. Please check your API key.');
                } finally {
                    setLoading(false);
                }
            };
            
            const testApiConnection = async () => {
                if (!apiKey) {
                    setApiError('Please enter an API key first');
                    return;
                }
                
                setLoading(true);
                setApiError('');
                
                try {
                    // Update the market data service
                    aiEngine.marketData.API_KEY = apiKey;
                    aiEngine.marketData.provider = apiProvider;
                    
                    // Test with a known symbol
                    const testSymbol = 'AAPL';
                    const quote = await aiEngine.marketData.getQuote(testSymbol);
                    
                    if (quote && quote.price > 0) {
                        setApiError('');
                        alert(`✅ Success! Connected to ${apiProvider}. Test quote: ${testSymbol} = ${quote.price}`);
                    } else {
                        throw new Error('Invalid response from API');
                    }
                } catch (error) {
                    console.error('API test failed:', error);
                    setApiError(`Connection failed: ${error.message}. Please check your API key.`);
                } finally {
                    setLoading(false);
                }
            };
            
            const saveApiConfiguration = () => {
                if (!apiKey) {
                    setApiError('Please enter an API key');
                    return;
                }
                
                // Save to localStorage
                localStorage.setItem('opusTraderApiKey', apiKey);
                localStorage.setItem('opusTraderApiProvider', apiProvider);
                
                // Update the market data service
                aiEngine.marketData.API_KEY = apiKey;
                aiEngine.marketData.provider = apiProvider;
                
                setApiConfigured(true);
                setApiError('');
                
                // Generate signals immediately after configuration
                generateNewSignals();
            };
            
            const addToWatchlist = () => {
                if (newSymbol && !watchlist.includes(newSymbol.toUpperCase())) {
                    setWatchlist([...watchlist, newSymbol.toUpperCase()]);
                    setNewSymbol('');
                }
            };
            
            const removeFromWatchlist = (symbol) => {
                setWatchlist(watchlist.filter(s => s !== symbol));
            };
            
            if (!hasAcceptedTerms) {
                return (
                    <div className="app">
                        <header className="header">
                            <nav className="nav">
                                <div className="logo">OpusTrader</div>
                            </nav>
                        </header>
                        
                        <div className="container">
                            <div style={{ textAlign: 'center', padding: '4rem 2rem' }}>
                                <h1 style={{ fontSize: '3rem', fontWeight: '700', marginBottom: '1rem' }}>
                                    Welcome to OpusTrader
                                </h1>
                                <p style={{ fontSize: '1.25rem', color: '#9ca3af', marginBottom: '2rem' }}>
                                    AI-Powered Weekly Options Signals
                                </p>
                                <button 
                                    className="btn btn-primary" 
                                    onClick={() => setShowLegalModal(true)}
                                    style={{ fontSize: '1.125rem', padding: '0.75rem 2rem' }}
                                >
                                    Get Started
                                </button>
                            </div>
                        </div>
                        
                        <LegalDisclosureModal
                            isOpen={showLegalModal}
                            onClose={() => setShowLegalModal(false)}
                            onAccept={handleAcceptTerms}
                        />
                    </div>
                );
            }
            
            return (
                <div className="app">
                    <header className="header">
                        <nav className="nav">
                            <div className="logo">OpusTrader</div>
                            <div className="nav-links">
                                <a href="#" className="nav-link">Dashboard</a>
                                <a href="#" className="nav-link">Settings</a>
                                <a href="#" className="nav-link" onClick={() => setShowLegalModal(true)}>
                                    Legal
                                </a>
                                <button className="btn btn-primary" onClick={generateNewSignals}>
                                    Refresh Signals
                                </button>
                            </div>
                        </nav>
                    </header>
                    
                    <div className="container">
                        <div className="dashboard">
                            <div className="stats-grid">
                                <div className="stat-card">
                                    <div className="stat-label">Weekly Signals</div>
                                    <div className="stat-value">{stats.weeklySignals}</div>
                                </div>
                                <div className="stat-card">
                                    <div className="stat-label">Avg AI Confidence</div>
                                    <div className="stat-value">
                                        {(stats.avgConfidence * 100).toFixed(0)}%
                                    </div>
                                </div>
                                <div className="stat-card">
                                    <div className="stat-label">Historical Success</div>
                                    <div className="stat-value">
                                        {(stats.successRate * 100).toFixed(0)}%
                                    </div>
                                </div>
                                <div className="stat-card">
                                    <div className="stat-label">Active Positions</div>
                                    <div className="stat-value">{stats.activeTrades}</div>
                                </div>
                            </div>
                            
                            <div className="signals-section">
                                <div className="section-header">
                                    <h2 className="section-title">This Week's AI Signals</h2>
                                    <span style={{ color: '#9ca3af', fontSize: '0.875rem' }}>
                                        Expires: {aiEngine.getNextFriday()}
                                    </span>
                                </div>
                                
                                {loading ? (
                                    <div className="loading">
                                        <div className="spinner"></div>
                                    </div>
                                ) : signals.length > 0 ? (
                                    <>
                                        <div className="signal-grid">
                                            {signals.map(signal => (
                                                <SignalCard key={signal.id} signal={signal} />
                                            ))}
                                        </div>
                                        
                                        <div className="chart-container">
                                            <canvas ref={chartRef}></canvas>
                                        </div>
                                    </>
                                ) : (
                                    <div className="empty-state">
                                        <h3>No signals generated yet</h3>
                                        <p>Click "Refresh Signals" to generate new AI-powered signals</p>
                                    </div>
                                )}
                            </div>
                            
                            <div className="settings-section">
                                <h2 className="section-title">Watchlist Settings</h2>
                                
                                <div className="input-group">
                                    <label className="input-label">Add Symbol to Watchlist</label>
                                    <div style={{ display: 'flex', gap: '1rem' }}>
                                        <input
                                            type="text"
                                            className="input"
                                            placeholder="Enter symbol (e.g., AAPL)"
                                            value={newSymbol}
                                            onChange={(e) => setNewSymbol(e.target.value)}
                                            onKeyPress={(e) => e.key === 'Enter' && addToWatchlist()}
                                        />
                                        <button className="btn btn-primary" onClick={addToWatchlist}>
                                            Add
                                        </button>
                                    </div>
                                </div>
                                
                                <div className="input-group">
                                    <label className="input-label">Current Watchlist</label>
                                    <div className="watchlist">
                                        {watchlist.map(symbol => (
                                            <div key={symbol} className="watchlist-item">
                                                {symbol}
                                                <span 
                                                    className="remove-btn" 
                                                    onClick={() => removeFromWatchlist(symbol)}
                                                >
                                                    ✕
                                                </span>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>
                            
                            <div className="settings-section">
                                <h2 className="section-title">API Configuration</h2>
                                
                                <div style={{
                                    background: 'rgba(99, 102, 241, 0.1)',
                                    border: '1px solid rgba(99, 102, 241, 0.3)',
                                    borderRadius: '0.5rem',
                                    padding: '1rem',
                                    marginBottom: '1.5rem'
                                }}>
                                    <h3 style={{ fontSize: '1rem', marginBottom: '0.5rem' }}>
                                        📊 Real-Time Data Providers
                                    </h3>
                                    <p style={{ fontSize: '0.875rem', color: '#9ca3af', marginBottom: '1rem' }}>
                                        To get real-time market data, sign up for a free API key from one of these providers:
                                    </p>
                                    <ul style={{ fontSize: '0.875rem', color: '#e1e4ed', paddingLeft: '1.5rem' }}>
                                        <li><strong>Alpha Vantage</strong> - Free: 5 req/min, 500/day - <a href="https://www.alphavantage.co/support/#api-key" target="_blank" style={{color: '#6366f1'}}>Get Key</a></li>
                                        <li><strong>Polygon.io</strong> - Free: 5 req/min - <a href="https://polygon.io/dashboard/signup" target="_blank" style={{color: '#6366f1'}}>Get Key</a></li>
                                        <li><strong>Finnhub</strong> - Free: 60 req/min - <a href="https://finnhub.io/register" target="_blank" style={{color: '#6366f1'}}>Get Key</a></li>
                                        <li><strong>MarketStack</strong> - Free: 100 req/month - <a href="https://marketstack.com/product" target="_blank" style={{color: '#6366f1'}}>Get Key</a></li>
                                    </ul>
                                </div>
                                
                                <div className="input-group">
                                    <label className="input-label">Select Data Provider</label>
                                    <select 
                                        className="input"
                                        value={apiProvider}
                                        onChange={(e) => setApiProvider(e.target.value)}
                                    >
                                        <option value="alphavantage">Alpha Vantage (Best for Free)</option>
                                        <option value="polygon">Polygon.io (Best Data Quality)</option>
                                        <option value="finnhub">Finnhub (Good Alternative)</option>
                                        <option value="marketstack">MarketStack (Basic)</option>
                                    </select>
                                </div>
                                
                                <div className="input-group">
                                    <label className="input-label">API Key</label>
                                    <input
                                        type="text"
                                        className="input"
                                        placeholder="Enter your API key"
                                        value={apiKey}
                                        onChange={(e) => setApiKey(e.target.value)}
                                        onKeyPress={(e) => e.key === 'Enter' && saveApiConfiguration()}
                                    />
                                    <p style={{ fontSize: '0.75rem', color: '#9ca3af', marginTop: '0.5rem' }}>
                                        Get your free API key from your chosen provider's website
                                    </p>
                                </div>
                                
                                <div style={{ display: 'flex', gap: '1rem', alignItems: 'center' }}>
                                    <button 
                                        className="btn btn-secondary" 
                                        onClick={testApiConnection}
                                        disabled={!apiKey || loading}
                                        style={{ 
                                            opacity: apiKey && !loading ? 1 : 0.5, 
                                            cursor: apiKey && !loading ? 'pointer' : 'not-allowed' 
                                        }}
                                    >
                                        {loading ? 'Testing...' : 'Test Connection'}
                                    </button>
                                    
                                    <button 
                                        className="btn btn-primary" 
                                        onClick={saveApiConfiguration}
                                        disabled={!apiKey}
                                        style={{ 
                                            opacity: apiKey ? 1 : 0.5, 
                                            cursor: apiKey ? 'pointer' : 'not-allowed' 
                                        }}
                                    >
                                        Save & Connect
                                    </button>
                                    
                                    {apiConfigured && (
                                        <span style={{ color: '#10b981', fontSize: '0.875rem' }}>
                                            ✓ API Connected
                                        </span>
                                    )}
                                </div>
                                
                                {apiError && (
                                    <div style={{ 
                                        marginTop: '1rem',
                                        padding: '0.75rem',
                                        background: 'rgba(239, 68, 68, 0.1)',
                                        border: '1px solid rgba(239, 68, 68, 0.3)',
                                        borderRadius: '0.5rem',
                                        color: '#ef4444',
                                        fontSize: '0.875rem'
                                    }}>
                                        {apiError}
                                    </div>
                                )}
                                
                                <div style={{ 
                                    marginTop: '1.5rem', 
                                    padding: '1rem',
                                    background: 'rgba(239, 68, 68, 0.1)',
                                    border: '1px solid rgba(239, 68, 68, 0.3)',
                                    borderRadius: '0.5rem'
                                }}>
                                    <p style={{ fontSize: '0.875rem', color: '#f59e0b', marginBottom: '0.5rem' }}>
                                        ⚠️ <strong>Important:</strong> Browser Security (CORS) Notice
                                    </p>
                                    <p style={{ fontSize: '0.875rem', color: '#9ca3af' }}>
                                        Most APIs block direct browser requests for security. To use real data:
                                    </p>
                                    <ol style={{ fontSize: '0.875rem', color: '#9ca3af', marginTop: '0.5rem', paddingLeft: '1.5rem' }}>
                                        <li>Use a CORS proxy: Add <code style={{background: '#1a1a1a', padding: '2px 4px', borderRadius: '3px'}}>https://cors-anywhere.herokuapp.com/</code> before the API URL</li>
                                        <li>Or run a local backend server (recommended for production)</li>
                                        <li>Or use the simulated data mode for testing</li>
                                    </ol>
                                    <p style={{ fontSize: '0.875rem', color: '#9ca3af', marginTop: '0.5rem' }}>
                                        Without these solutions, the app will use simulated market data.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <LegalDisclosureModal
                        isOpen={showLegalModal}
                        onClose={() => setShowLegalModal(false)}
                        onAccept={handleAcceptTerms}
                    />
                </div>
            );
        };
        
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
